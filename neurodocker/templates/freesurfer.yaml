---
# Instructions to install FreeSurfer.
#
# Repository: https://github.com/freesurfer/freesurfer
# Website: https://surfer.nmr.mgh.harvard.edu/
# Documentation: https://surfer.nmr.mgh.harvard.edu/fswiki
# libqt4-scripttools limits this to Centos6,7 Debian 8-10, Ubuntu 14-19

generic:
  binaries:
    urls:
      "6.0.0-min": https://dl.dropbox.com/s/nnzcfttc41qvt31/recon-all-freesurfer6-3.min.tgz
      # See https://github.com/freesurfer/freesurfer/issues/70
      "6.0.0": ftp://surfer.nmr.mgh.harvard.edu/pub/dist/freesurfer/6.0.0/freesurfer-Linux-centos6_x86_64-stable-pub-v6.0.0.tar.gz
      "6.0.1": ftp://surfer.nmr.mgh.harvard.edu/pub/dist/freesurfer/6.0.1/freesurfer-Linux-centos6_x86_64-stable-pub-v6.0.1.tar.gz
      # 6.0.1 binary build tested in:
      # Ubuntu 16.04: 
      # Centos6: 
      # Ubuntu 18.04: 
      "7.0.0": ftp://surfer.nmr.mgh.harvard.edu/pub/dist/freesurfer/7.0.0/freesurfer-linux-centos6_x86_64-7.0.0.tar.gz
      # tested in:
      # Centos6: QT error
      # Ubuntu 16.04: version `Qt_5' not found (required by freeview)
      # Ubuntu 18.04: 
    dependencies:
      apt: bc libgomp1 libxmu6 libxt6 tcsh perl libqt5widgets5 libqt5x11extras5 libglu1-mesa qt5-default libqt4-scripttools libqt4-opengl libxss1 libxft2 libjpeg62
      yum: bc libgomp libXmu libXt tcsh perl qt-x11 qt5-qtdeclarative qt5-qtbase-gui qt5-qtx11extras mesa-libGLU libXScrnSaver libXft libjpeg-turbo
    env:
      FREESURFER_HOME: "{{ freesurfer.install_path }}"
      PATH: "{{ freesurfer.install_path }}/bin:$PATH"
    instructions: |
      {{ freesurfer.install_dependencies() }}
      echo "Downloading FreeSurfer ..."
      mkdir -p {{ freesurfer.install_path }}
      curl {{ freesurfer.curl_opts }} {{ freesurfer.binaries_url }} \
      | tar -xz -C {{ freesurfer.install_path }} --strip-components 1 {% if freesurfer.exclude_paths -%}\
      {%- for exclude_path in freesurfer.exclude_paths %}
        {% if not loop.last -%}
        --exclude='{{ exclude_path }}' \
        {%- else -%}
        --exclude='{{ exclude_path }}'
        {%- endif -%}
      {%- endfor %}
      {%- endif %}
      sed -i '$isource "{{ freesurfer.install_path }}/SetUpFreeSurfer.sh"' "$ND_ENTRYPOINT"
